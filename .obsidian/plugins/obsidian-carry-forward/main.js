/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

const DEFAULT_SETTINGS = {
    linkText: "",
    copiedLinkText: "(see {{LINK}})",
    lineFormatFrom: "\\s*$",
    lineFormatTo: " (see {{LINK}})",
    removeLeadingWhitespace: true,
};
const genID = (length = 5) => {
    const characters = "abcdefghijklmnopqrstuvwxyz-0123456789";
    let id = "";
    while (id.length < length) {
        id += characters[Math.floor(Math.random() * characters.length)];
    }
    return id.slice(0, length);
};
var CopyTypes;
(function (CopyTypes) {
    CopyTypes[CopyTypes["SeparateLines"] = 0] = "SeparateLines";
    CopyTypes[CopyTypes["CombinedLines"] = 1] = "CombinedLines";
    CopyTypes[CopyTypes["LinkOnly"] = 2] = "LinkOnly";
    CopyTypes[CopyTypes["LinkOnlyEmbed"] = 3] = "LinkOnlyEmbed";
})(CopyTypes || (CopyTypes = {}));
const blockIDRegex = /(?<=[\s^])\^[a-zA-Z0-9-]+$/u;
const copyForwardLines = (editor, view, settings, copy = CopyTypes.SeparateLines) => {
    var _a;
    const regexValidation = validateRegex(settings.lineFormatFrom);
    if (regexValidation.valid !== true) {
        new obsidian.Notice(`Error: 'From' setting is invalid:\n\n${regexValidation.string}\n\nPlease update the Carry-Forward settings and try again.`, 1000 * 30 // 30 seconds
        );
        return;
    }
    const cursorFrom = editor.getCursor("from");
    const cursorTo = editor.getCursor("to");
    const minLine = cursorFrom.line;
    const maxLine = cursorTo.line;
    const transaction = {
        changes: [],
    };
    const file = view.file;
    const updatedLines = [];
    const copiedLines = [];
    let newID = "";
    for (let lineNumber = minLine; lineNumber <= maxLine; lineNumber++) {
        let line = editor.getLine(lineNumber);
        let copiedLine = line;
        if (settings.removeLeadingWhitespace === true && (lineNumber === minLine && cursorFrom.ch === cursorTo.ch)) {
            // Remove leading whitespace if the user is copying a full line without
            // having selected a specific part of the line:
            copiedLine = copiedLine.replace(/^\s*/, '');
        }
        if ((lineNumber === minLine || lineNumber === maxLine) &&
            !(minLine === maxLine && cursorFrom.ch === cursorTo.ch)) {
            copiedLine = line.slice(lineNumber === minLine ? cursorFrom.ch : 0, lineNumber === maxLine ? cursorTo.ch : line.length - 1);
        }
        if (editor.getLine(lineNumber).match(/^\s*$/) &&
            !(lineNumber === minLine && minLine === maxLine)) {
            copiedLines.push(copiedLine);
            updatedLines.push(line);
            continue;
        }
        if (copy === CopyTypes.SeparateLines || lineNumber === minLine) {
            // Does the line already have a block ID?
            const blockID = line.match(blockIDRegex);
            let link = "";
            if (blockID === null) {
                // There is NOT an existing line ID:
                newID = `^${genID()}`;
                link = view.app.fileManager.generateMarkdownLink(file, "/", `#${newID}`, settings.linkText);
                line = line.replace(/\s*?$/, ` ${newID}`);
                if (copy === CopyTypes.LinkOnly || copy === CopyTypes.LinkOnlyEmbed) {
                    link = (copy === CopyTypes.LinkOnlyEmbed ? "!" : "") + link;
                    copiedLine =
                        copy === CopyTypes.LinkOnlyEmbed
                            ? link
                            : settings.copiedLinkText.replace("{{LINK}}", link);
                }
                else {
                    copiedLine = copiedLine.replace(new RegExp(settings.lineFormatFrom, "u"), settings.lineFormatTo.replace("{{LINK}}", link));
                }
            }
            else {
                // There IS an existing line ID:
                link = view.app.fileManager.generateMarkdownLink(file, "/", `#${blockID}`, settings.linkText);
                if (copy === CopyTypes.LinkOnly || copy === CopyTypes.LinkOnlyEmbed) {
                    link = (copy === CopyTypes.LinkOnlyEmbed ? "!" : "") + link;
                    copiedLine =
                        copy === CopyTypes.LinkOnlyEmbed
                            ? link
                            : settings.copiedLinkText.replace("{{LINK}}", link);
                }
                else {
                    copiedLine = copiedLine
                        .replace(blockIDRegex, "")
                        .replace(new RegExp(settings.lineFormatFrom, "u"), settings.lineFormatTo.replace("{{LINK}}", link));
                }
            }
        }
        if (!((copy === CopyTypes.LinkOnly || copy === CopyTypes.LinkOnlyEmbed) &&
            lineNumber !== minLine)) {
            copiedLines.push(copiedLine);
        }
        updatedLines.push(line);
    }
    navigator.clipboard.writeText(copiedLines.join("\n")).then(() => {
        new obsidian.Notice("Copied");
    });
    (_a = transaction.changes) === null || _a === void 0 ? void 0 : _a.push({
        from: { line: minLine, ch: 0 },
        to: { line: maxLine, ch: editor.getLine(maxLine).length },
        text: updatedLines.join("\n"),
    });
    transaction.selection = { from: cursorFrom, to: cursorTo };
    editor.transaction(transaction);
};
class CarryForwardPlugin extends obsidian.Plugin {
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log("loading carry-forward-line plugin");
            yield this.loadSettings();
            this.addCommand({
                id: "carry-line-forward-separate-lines",
                name: "Copy selection with each line linked to its copied source",
                editorCallback: (editor, view) => {
                    return copyForwardLines(editor, view, this.settings, CopyTypes.SeparateLines);
                },
            });
            this.addCommand({
                id: "carry-line-forward-combined-lines",
                name: "Copy selection with first line linked to its copied source",
                editorCallback: (editor, view) => {
                    return copyForwardLines(editor, view, this.settings, CopyTypes.CombinedLines);
                },
            });
            this.addCommand({
                id: "carry-line-forward-link-only",
                name: "Copy link to line",
                editorCallback: (editor, view) => {
                    return copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnly);
                },
            });
            this.addCommand({
                id: "carry-line-forward-embed-link-only",
                name: "Copy embed link to line",
                editorCallback: (editor, view) => {
                    return copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnlyEmbed);
                },
            });
            this.addSettingTab(new CarryForwardSettingTab(this.app, this));
        });
    }
    onunload() {
        console.log("unloading carry-forward-line plugin");
    }
    loadSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
        });
    }
    saveSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.saveData(this.settings);
        });
    }
}
const validateRegex = (regexString) => {
    let updatedRegexString = regexString
        // Because the plugin's settings are stored in JSON, characters like
        // \n get double-escaped, and then do not get replaced automatically
        // on use. This was causing To strings not to parse \n, etc.
        .replace(/\\n/g, "\n")
        .replace(/\\t/g, "\t")
        .replace(/\\r/g, "\r");
    try {
        new RegExp(updatedRegexString, "u");
        return { valid: true, string: updatedRegexString };
    }
    catch (e) {
        return {
            valid: false,
            string: `"${updatedRegexString}": "${e}"`,
        };
    }
};
class CarryForwardSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        let { containerEl } = this;
        containerEl.empty();
        containerEl.createEl("h2", { text: "Carry-forward" });
        new obsidian.Setting(containerEl)
            .setName("Link text")
            .setDesc("Text of links. Leaving this blank will display the text of the actual link.")
            .addText((text) => {
            const settings = this.plugin.settings;
            text.setValue(settings.linkText).onChange((value) => __awaiter(this, void 0, void 0, function* () {
                settings.linkText = value;
                yield this.plugin.saveSettings();
            }));
        });
        new obsidian.Setting(containerEl)
            .setName("Copied text")
            .setDesc("The full text of copied references. Use {{LINK}} to place the link.")
            .addText((text) => {
            const settings = this.plugin.settings;
            text.setValue(settings.copiedLinkText).onChange((value) => __awaiter(this, void 0, void 0, function* () {
                settings.copiedLinkText = value;
                yield this.plugin.saveSettings();
            }));
        });
        const fromToEl = containerEl.createEl("div");
        fromToEl.addClass("from-to-rule");
        if (validateRegex(this.plugin.settings.lineFormatFrom).valid !== true) {
            fromToEl.addClass("invalid");
        }
        new obsidian.Setting(fromToEl)
            .setName("Transform copied line")
            .setDesc("When copying a line, replace the first match of a Regular Expression with text. Use {{LINK}} in the To field to place the link.")
            .addText((text) => text
            .setPlaceholder(`From (Default: "${DEFAULT_SETTINGS.lineFormatFrom}")`)
            .setValue(this.plugin.settings.lineFormatFrom)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            if (value === "") {
                this.plugin.settings.lineFormatFrom =
                    DEFAULT_SETTINGS.lineFormatFrom;
            }
            else {
                if (validateRegex(value).valid !== true) {
                    fromToEl.addClass("invalid");
                }
                else {
                    fromToEl.removeClass("invalid");
                }
                this.plugin.settings.lineFormatFrom = value;
            }
            yield this.plugin.saveSettings();
        })))
            .addText((text) => text
            .setPlaceholder(`To (Default: "${DEFAULT_SETTINGS.lineFormatTo}")`)
            .setValue(this.plugin.settings.lineFormatTo)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            if (value === "") {
                this.plugin.settings.lineFormatTo = DEFAULT_SETTINGS.lineFormatTo;
            }
            else {
                this.plugin.settings.lineFormatTo = value;
            }
            yield this.plugin.saveSettings();
        })));
        new obsidian.Setting(containerEl)
            .setName("Remove leading whitespace from first line")
            .setDesc("When copying a line without having selected a specific part of that line, remove any whitespace at the beginning of the copy.")
            .addToggle((toggle) => {
            const settings = this.plugin.settings;
            toggle.setValue(settings.removeLeadingWhitespace).onChange((value) => __awaiter(this, void 0, void 0, function* () {
                settings.removeLeadingWhitespace = value;
                yield this.plugin.saveSettings();
            }));
        });
    }
}

module.exports = CarryForwardPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIm1haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XHJcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEhcclxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXHJcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcclxuSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NXHJcbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXHJcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcclxuUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH1cclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcclxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19jcmVhdGVCaW5kaW5nID0gT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcclxufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICBvW2syXSA9IG1ba107XHJcbn0pO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBvKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSBcImRlZmF1bHRcIiAmJiAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIHApKSBfX2NyZWF0ZUJpbmRpbmcobywgbSwgcCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09IFwibnVtYmVyXCIpIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/IFwiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS5cIiA6IFwiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheXMoKSB7XHJcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcclxuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcclxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcclxuICAgICAgICAgICAgcltrXSA9IGFbal07XHJcbiAgICByZXR1cm4gcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkodG8sIGZyb20sIHBhY2spIHtcclxuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xyXG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xyXG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcclxuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xyXG4gICAgdmFyIGksIHA7XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogbiA9PT0gXCJyZXR1cm5cIiB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY1ZhbHVlcyhvKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcclxuICAgIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09IFwiZnVuY3Rpb25cIiA/IF9fdmFsdWVzKG8pIDogb1tTeW1ib2wuaXRlcmF0b3JdKCksIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpKTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZCwgcmF3KSB7XHJcbiAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsIFwicmF3XCIsIHsgdmFsdWU6IHJhdyB9KTsgfSBlbHNlIHsgY29va2VkLnJhdyA9IHJhdzsgfVxyXG4gICAgcmV0dXJuIGNvb2tlZDtcclxufTtcclxuXHJcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcclxufSkgOiBmdW5jdGlvbihvLCB2KSB7XHJcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcclxuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRHZXQocmVjZWl2ZXIsIHN0YXRlLCBraW5kLCBmKSB7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXJcIik7XHJcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiBraW5kID09PSBcIm1cIiA/IGYgOiBraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlcikgOiBmID8gZi52YWx1ZSA6IHN0YXRlLmdldChyZWNlaXZlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHJlY2VpdmVyLCBzdGF0ZSwgdmFsdWUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcIm1cIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgbWV0aG9kIGlzIG5vdCB3cml0YWJsZVwiKTtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIHNldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHdyaXRlIHByaXZhdGUgbWVtYmVyIHRvIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XHJcbiAgICByZXR1cm4gKGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTtcclxufVxyXG4iLCJpbXBvcnQge1xuICBBcHAsXG4gIEVkaXRvcixcbiAgRWRpdG9yVHJhbnNhY3Rpb24sXG4gIE1hcmtkb3duVmlldyxcbiAgTm90aWNlLFxuICBQbHVnaW4sXG4gIFBsdWdpblNldHRpbmdUYWIsXG4gIFNldHRpbmcsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgQ2FycnlGb3J3YXJkUGx1Z2luU2V0dGluZ3Mge1xuICBsaW5rVGV4dDogc3RyaW5nO1xuICBjb3BpZWRMaW5rVGV4dDogc3RyaW5nO1xuICBsaW5lRm9ybWF0RnJvbTogc3RyaW5nO1xuICBsaW5lRm9ybWF0VG86IHN0cmluZztcbiAgcmVtb3ZlTGVhZGluZ1doaXRlc3BhY2U6IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IENhcnJ5Rm9yd2FyZFBsdWdpblNldHRpbmdzID0ge1xuICBsaW5rVGV4dDogXCJcIixcbiAgY29waWVkTGlua1RleHQ6IFwiKHNlZSB7e0xJTkt9fSlcIixcbiAgbGluZUZvcm1hdEZyb206IFwiXFxcXHMqJFwiLFxuICBsaW5lRm9ybWF0VG86IFwiIChzZWUge3tMSU5LfX0pXCIsXG4gIHJlbW92ZUxlYWRpbmdXaGl0ZXNwYWNlOiB0cnVlLFxufTtcblxuY29uc3QgZ2VuSUQgPSAobGVuZ3RoID0gNSkgPT4ge1xuICBjb25zdCBjaGFyYWN0ZXJzID0gXCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ei0wMTIzNDU2Nzg5XCI7XG4gIGxldCBpZCA9IFwiXCI7XG4gIHdoaWxlIChpZC5sZW5ndGggPCBsZW5ndGgpIHtcbiAgICBpZCArPSBjaGFyYWN0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJhY3RlcnMubGVuZ3RoKV07XG4gIH1cbiAgcmV0dXJuIGlkLnNsaWNlKDAsIGxlbmd0aCk7XG59O1xuXG5lbnVtIENvcHlUeXBlcyB7XG4gIFNlcGFyYXRlTGluZXMsXG4gIENvbWJpbmVkTGluZXMsXG4gIExpbmtPbmx5LFxuICBMaW5rT25seUVtYmVkLFxufVxuXG5jb25zdCBibG9ja0lEUmVnZXggPSAvKD88PVtcXHNeXSlcXF5bYS16QS1aMC05LV0rJC91O1xuXG5jb25zdCBjb3B5Rm9yd2FyZExpbmVzID0gKFxuICBlZGl0b3I6IEVkaXRvcixcbiAgdmlldzogTWFya2Rvd25WaWV3LFxuICBzZXR0aW5nczogQ2FycnlGb3J3YXJkUGx1Z2luU2V0dGluZ3MsXG4gIGNvcHk6IENvcHlUeXBlcyA9IENvcHlUeXBlcy5TZXBhcmF0ZUxpbmVzXG4pID0+IHtcbiAgY29uc3QgcmVnZXhWYWxpZGF0aW9uID0gdmFsaWRhdGVSZWdleChzZXR0aW5ncy5saW5lRm9ybWF0RnJvbSk7XG4gIGlmIChyZWdleFZhbGlkYXRpb24udmFsaWQgIT09IHRydWUpIHtcbiAgICBuZXcgTm90aWNlKFxuICAgICAgYEVycm9yOiAnRnJvbScgc2V0dGluZyBpcyBpbnZhbGlkOlxcblxcbiR7cmVnZXhWYWxpZGF0aW9uLnN0cmluZ31cXG5cXG5QbGVhc2UgdXBkYXRlIHRoZSBDYXJyeS1Gb3J3YXJkIHNldHRpbmdzIGFuZCB0cnkgYWdhaW4uYCxcbiAgICAgIDEwMDAgKiAzMCAvLyAzMCBzZWNvbmRzXG4gICAgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBjdXJzb3JGcm9tID0gZWRpdG9yLmdldEN1cnNvcihcImZyb21cIik7XG4gIGNvbnN0IGN1cnNvclRvID0gZWRpdG9yLmdldEN1cnNvcihcInRvXCIpO1xuICBjb25zdCBtaW5MaW5lID0gY3Vyc29yRnJvbS5saW5lO1xuICBjb25zdCBtYXhMaW5lID0gY3Vyc29yVG8ubGluZTtcblxuICBjb25zdCB0cmFuc2FjdGlvbjogRWRpdG9yVHJhbnNhY3Rpb24gPSB7XG4gICAgY2hhbmdlczogW10sXG4gIH07XG5cbiAgY29uc3QgZmlsZSA9IHZpZXcuZmlsZTtcblxuICBjb25zdCB1cGRhdGVkTGluZXM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IGNvcGllZExpbmVzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgbmV3SUQgPSBcIlwiO1xuICBmb3IgKGxldCBsaW5lTnVtYmVyID0gbWluTGluZTsgbGluZU51bWJlciA8PSBtYXhMaW5lOyBsaW5lTnVtYmVyKyspIHtcbiAgICBsZXQgbGluZSA9IGVkaXRvci5nZXRMaW5lKGxpbmVOdW1iZXIpO1xuICAgIGxldCBjb3BpZWRMaW5lID0gbGluZTtcbiAgICBpZiAoc2V0dGluZ3MucmVtb3ZlTGVhZGluZ1doaXRlc3BhY2UgPT09IHRydWUgJiYgKGxpbmVOdW1iZXIgPT09IG1pbkxpbmUgJiYgY3Vyc29yRnJvbS5jaCA9PT0gY3Vyc29yVG8uY2gpKSB7XG4gICAgICAvLyBSZW1vdmUgbGVhZGluZyB3aGl0ZXNwYWNlIGlmIHRoZSB1c2VyIGlzIGNvcHlpbmcgYSBmdWxsIGxpbmUgd2l0aG91dFxuICAgICAgLy8gaGF2aW5nIHNlbGVjdGVkIGEgc3BlY2lmaWMgcGFydCBvZiB0aGUgbGluZTpcbiAgICAgIGNvcGllZExpbmUgPSBjb3BpZWRMaW5lLnJlcGxhY2UoL15cXHMqLywgJycpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIChsaW5lTnVtYmVyID09PSBtaW5MaW5lIHx8IGxpbmVOdW1iZXIgPT09IG1heExpbmUpICYmXG4gICAgICAhKG1pbkxpbmUgPT09IG1heExpbmUgJiYgY3Vyc29yRnJvbS5jaCA9PT0gY3Vyc29yVG8uY2gpXG4gICAgKSB7XG4gICAgICBjb3BpZWRMaW5lID0gbGluZS5zbGljZShcbiAgICAgICAgbGluZU51bWJlciA9PT0gbWluTGluZSA/IGN1cnNvckZyb20uY2ggOiAwLFxuICAgICAgICBsaW5lTnVtYmVyID09PSBtYXhMaW5lID8gY3Vyc29yVG8uY2ggOiBsaW5lLmxlbmd0aCAtIDFcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgZWRpdG9yLmdldExpbmUobGluZU51bWJlcikubWF0Y2goL15cXHMqJC8pICYmXG4gICAgICAhKGxpbmVOdW1iZXIgPT09IG1pbkxpbmUgJiYgbWluTGluZSA9PT0gbWF4TGluZSlcbiAgICApIHtcbiAgICAgIGNvcGllZExpbmVzLnB1c2goY29waWVkTGluZSk7XG4gICAgICB1cGRhdGVkTGluZXMucHVzaChsaW5lKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChjb3B5ID09PSBDb3B5VHlwZXMuU2VwYXJhdGVMaW5lcyB8fCBsaW5lTnVtYmVyID09PSBtaW5MaW5lKSB7XG4gICAgICAvLyBEb2VzIHRoZSBsaW5lIGFscmVhZHkgaGF2ZSBhIGJsb2NrIElEP1xuICAgICAgY29uc3QgYmxvY2tJRCA9IGxpbmUubWF0Y2goYmxvY2tJRFJlZ2V4KTtcbiAgICAgIGxldCBsaW5rID0gXCJcIjtcbiAgICAgIGlmIChibG9ja0lEID09PSBudWxsKSB7XG4gICAgICAgIC8vIFRoZXJlIGlzIE5PVCBhbiBleGlzdGluZyBsaW5lIElEOlxuICAgICAgICBuZXdJRCA9IGBeJHtnZW5JRCgpfWA7XG4gICAgICAgIGxpbmsgPSB2aWV3LmFwcC5maWxlTWFuYWdlci5nZW5lcmF0ZU1hcmtkb3duTGluayhcbiAgICAgICAgICBmaWxlLFxuICAgICAgICAgIFwiL1wiLFxuICAgICAgICAgIGAjJHtuZXdJRH1gLFxuICAgICAgICAgIHNldHRpbmdzLmxpbmtUZXh0XG4gICAgICAgICk7XG4gICAgICAgIGxpbmUgPSBsaW5lLnJlcGxhY2UoL1xccyo/JC8sIGAgJHtuZXdJRH1gKTtcbiAgICAgICAgaWYgKGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seSB8fCBjb3B5ID09PSBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCkge1xuICAgICAgICAgIGxpbmsgPSAoY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5RW1iZWQgPyBcIiFcIiA6IFwiXCIpICsgbGluaztcbiAgICAgICAgICBjb3BpZWRMaW5lID1cbiAgICAgICAgICAgIGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seUVtYmVkXG4gICAgICAgICAgICAgID8gbGlua1xuICAgICAgICAgICAgICA6IHNldHRpbmdzLmNvcGllZExpbmtUZXh0LnJlcGxhY2UoXCJ7e0xJTkt9fVwiLCBsaW5rKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb3BpZWRMaW5lID0gY29waWVkTGluZS5yZXBsYWNlKFxuICAgICAgICAgICAgbmV3IFJlZ0V4cChzZXR0aW5ncy5saW5lRm9ybWF0RnJvbSwgXCJ1XCIpLFxuICAgICAgICAgICAgc2V0dGluZ3MubGluZUZvcm1hdFRvLnJlcGxhY2UoXCJ7e0xJTkt9fVwiLCBsaW5rKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRoZXJlIElTIGFuIGV4aXN0aW5nIGxpbmUgSUQ6XG4gICAgICAgIGxpbmsgPSB2aWV3LmFwcC5maWxlTWFuYWdlci5nZW5lcmF0ZU1hcmtkb3duTGluayhcbiAgICAgICAgICBmaWxlLFxuICAgICAgICAgIFwiL1wiLFxuICAgICAgICAgIGAjJHtibG9ja0lEfWAsXG4gICAgICAgICAgc2V0dGluZ3MubGlua1RleHRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seSB8fCBjb3B5ID09PSBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCkge1xuICAgICAgICAgIGxpbmsgPSAoY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5RW1iZWQgPyBcIiFcIiA6IFwiXCIpICsgbGluaztcbiAgICAgICAgICBjb3BpZWRMaW5lID1cbiAgICAgICAgICAgIGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seUVtYmVkXG4gICAgICAgICAgICAgID8gbGlua1xuICAgICAgICAgICAgICA6IHNldHRpbmdzLmNvcGllZExpbmtUZXh0LnJlcGxhY2UoXCJ7e0xJTkt9fVwiLCBsaW5rKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb3BpZWRMaW5lID0gY29waWVkTGluZVxuICAgICAgICAgICAgLnJlcGxhY2UoYmxvY2tJRFJlZ2V4LCBcIlwiKVxuICAgICAgICAgICAgLnJlcGxhY2UoXG4gICAgICAgICAgICAgIG5ldyBSZWdFeHAoc2V0dGluZ3MubGluZUZvcm1hdEZyb20sIFwidVwiKSxcbiAgICAgICAgICAgICAgc2V0dGluZ3MubGluZUZvcm1hdFRvLnJlcGxhY2UoXCJ7e0xJTkt9fVwiLCBsaW5rKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgICEoXG4gICAgICAgIChjb3B5ID09PSBDb3B5VHlwZXMuTGlua09ubHkgfHwgY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5RW1iZWQpICYmXG4gICAgICAgIGxpbmVOdW1iZXIgIT09IG1pbkxpbmVcbiAgICAgIClcbiAgICApIHtcbiAgICAgIGNvcGllZExpbmVzLnB1c2goY29waWVkTGluZSk7XG4gICAgfVxuICAgIHVwZGF0ZWRMaW5lcy5wdXNoKGxpbmUpO1xuICB9XG5cbiAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29waWVkTGluZXMuam9pbihcIlxcblwiKSkudGhlbigoKSA9PiB7XG4gICAgbmV3IE5vdGljZShcIkNvcGllZFwiKTtcbiAgfSk7XG5cbiAgdHJhbnNhY3Rpb24uY2hhbmdlcz8ucHVzaCh7XG4gICAgZnJvbTogeyBsaW5lOiBtaW5MaW5lLCBjaDogMCB9LFxuICAgIHRvOiB7IGxpbmU6IG1heExpbmUsIGNoOiBlZGl0b3IuZ2V0TGluZShtYXhMaW5lKS5sZW5ndGggfSxcbiAgICB0ZXh0OiB1cGRhdGVkTGluZXMuam9pbihcIlxcblwiKSxcbiAgfSk7XG4gIHRyYW5zYWN0aW9uLnNlbGVjdGlvbiA9IHsgZnJvbTogY3Vyc29yRnJvbSwgdG86IGN1cnNvclRvIH07XG4gIGVkaXRvci50cmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJyeUZvcndhcmRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogQ2FycnlGb3J3YXJkUGx1Z2luU2V0dGluZ3M7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGNvbnNvbGUubG9nKFwibG9hZGluZyBjYXJyeS1mb3J3YXJkLWxpbmUgcGx1Z2luXCIpO1xuXG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjYXJyeS1saW5lLWZvcndhcmQtc2VwYXJhdGUtbGluZXNcIixcbiAgICAgIG5hbWU6IFwiQ29weSBzZWxlY3Rpb24gd2l0aCBlYWNoIGxpbmUgbGlua2VkIHRvIGl0cyBjb3BpZWQgc291cmNlXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuU2VwYXJhdGVMaW5lc1xuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjYXJyeS1saW5lLWZvcndhcmQtY29tYmluZWQtbGluZXNcIixcbiAgICAgIG5hbWU6IFwiQ29weSBzZWxlY3Rpb24gd2l0aCBmaXJzdCBsaW5lIGxpbmtlZCB0byBpdHMgY29waWVkIHNvdXJjZVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLkNvbWJpbmVkTGluZXNcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2FycnktbGluZS1mb3J3YXJkLWxpbmstb25seVwiLFxuICAgICAgbmFtZTogXCJDb3B5IGxpbmsgdG8gbGluZVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLkxpbmtPbmx5XG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNhcnJ5LWxpbmUtZm9yd2FyZC1lbWJlZC1saW5rLW9ubHlcIixcbiAgICAgIG5hbWU6IFwiQ29weSBlbWJlZCBsaW5rIHRvIGxpbmVcIixcbiAgICAgIGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuICAgICAgICByZXR1cm4gY29weUZvcndhcmRMaW5lcyhcbiAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgdmlldyxcbiAgICAgICAgICB0aGlzLnNldHRpbmdzLFxuICAgICAgICAgIENvcHlUeXBlcy5MaW5rT25seUVtYmVkXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBDYXJyeUZvcndhcmRTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICBjb25zb2xlLmxvZyhcInVubG9hZGluZyBjYXJyeS1mb3J3YXJkLWxpbmUgcGx1Z2luXCIpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gIH1cbn1cblxuY29uc3QgdmFsaWRhdGVSZWdleCA9IChcbiAgcmVnZXhTdHJpbmc6IHN0cmluZ1xuKTogeyB2YWxpZDogYm9vbGVhbiB8IG51bGw7IHN0cmluZzogc3RyaW5nIH0gPT4ge1xuICBsZXQgdXBkYXRlZFJlZ2V4U3RyaW5nID0gcmVnZXhTdHJpbmdcbiAgICAvLyBCZWNhdXNlIHRoZSBwbHVnaW4ncyBzZXR0aW5ncyBhcmUgc3RvcmVkIGluIEpTT04sIGNoYXJhY3RlcnMgbGlrZVxuICAgIC8vIFxcbiBnZXQgZG91YmxlLWVzY2FwZWQsIGFuZCB0aGVuIGRvIG5vdCBnZXQgcmVwbGFjZWQgYXV0b21hdGljYWxseVxuICAgIC8vIG9uIHVzZS4gVGhpcyB3YXMgY2F1c2luZyBUbyBzdHJpbmdzIG5vdCB0byBwYXJzZSBcXG4sIGV0Yy5cbiAgICAucmVwbGFjZSgvXFxcXG4vZywgXCJcXG5cIilcbiAgICAucmVwbGFjZSgvXFxcXHQvZywgXCJcXHRcIilcbiAgICAucmVwbGFjZSgvXFxcXHIvZywgXCJcXHJcIik7XG5cbiAgdHJ5IHtcbiAgICBuZXcgUmVnRXhwKHVwZGF0ZWRSZWdleFN0cmluZywgXCJ1XCIpO1xuICAgIHJldHVybiB7IHZhbGlkOiB0cnVlLCBzdHJpbmc6IHVwZGF0ZWRSZWdleFN0cmluZyB9O1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgIHN0cmluZzogYFwiJHt1cGRhdGVkUmVnZXhTdHJpbmd9XCI6IFwiJHtlfVwiYCxcbiAgICB9O1xuICB9XG59O1xuXG5jbGFzcyBDYXJyeUZvcndhcmRTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogQ2FycnlGb3J3YXJkUGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IENhcnJ5Rm9yd2FyZFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgfVxuXG4gIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgbGV0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQ2FycnktZm9yd2FyZFwiIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkxpbmsgdGV4dFwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiVGV4dCBvZiBsaW5rcy4gTGVhdmluZyB0aGlzIGJsYW5rIHdpbGwgZGlzcGxheSB0aGUgdGV4dCBvZiB0aGUgYWN0dWFsIGxpbmsuXCJcbiAgICAgIClcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M7XG4gICAgICAgIHRleHQuc2V0VmFsdWUoc2V0dGluZ3MubGlua1RleHQpLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHNldHRpbmdzLmxpbmtUZXh0ID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQ29waWVkIHRleHRcIilcbiAgICAgIC5zZXREZXNjKFxuICAgICAgICBcIlRoZSBmdWxsIHRleHQgb2YgY29waWVkIHJlZmVyZW5jZXMuIFVzZSB7e0xJTkt9fSB0byBwbGFjZSB0aGUgbGluay5cIlxuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncztcbiAgICAgICAgdGV4dC5zZXRWYWx1ZShzZXR0aW5ncy5jb3BpZWRMaW5rVGV4dCkub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgc2V0dGluZ3MuY29waWVkTGlua1RleHQgPSB2YWx1ZTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIGNvbnN0IGZyb21Ub0VsID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIik7XG4gICAgZnJvbVRvRWwuYWRkQ2xhc3MoXCJmcm9tLXRvLXJ1bGVcIik7XG5cbiAgICBpZiAodmFsaWRhdGVSZWdleCh0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5lRm9ybWF0RnJvbSkudmFsaWQgIT09IHRydWUpIHtcbiAgICAgIGZyb21Ub0VsLmFkZENsYXNzKFwiaW52YWxpZFwiKTtcbiAgICB9XG5cbiAgICBuZXcgU2V0dGluZyhmcm9tVG9FbClcbiAgICAgIC5zZXROYW1lKFwiVHJhbnNmb3JtIGNvcGllZCBsaW5lXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJXaGVuIGNvcHlpbmcgYSBsaW5lLCByZXBsYWNlIHRoZSBmaXJzdCBtYXRjaCBvZiBhIFJlZ3VsYXIgRXhwcmVzc2lvbiB3aXRoIHRleHQuIFVzZSB7e0xJTkt9fSBpbiB0aGUgVG8gZmllbGQgdG8gcGxhY2UgdGhlIGxpbmsuXCJcbiAgICAgIClcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFxuICAgICAgICAgICAgYEZyb20gKERlZmF1bHQ6IFwiJHtERUZBVUxUX1NFVFRJTkdTLmxpbmVGb3JtYXRGcm9tfVwiKWBcbiAgICAgICAgICApXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmxpbmVGb3JtYXRGcm9tKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5lRm9ybWF0RnJvbSA9XG4gICAgICAgICAgICAgICAgREVGQVVMVF9TRVRUSU5HUy5saW5lRm9ybWF0RnJvbTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0ZVJlZ2V4KHZhbHVlKS52YWxpZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGZyb21Ub0VsLmFkZENsYXNzKFwiaW52YWxpZFwiKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmcm9tVG9FbC5yZW1vdmVDbGFzcyhcImludmFsaWRcIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGluZUZvcm1hdEZyb20gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihgVG8gKERlZmF1bHQ6IFwiJHtERUZBVUxUX1NFVFRJTkdTLmxpbmVGb3JtYXRUb31cIilgKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5lRm9ybWF0VG8pXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpbmVGb3JtYXRUbyA9IERFRkFVTFRfU0VUVElOR1MubGluZUZvcm1hdFRvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGluZUZvcm1hdFRvID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlJlbW92ZSBsZWFkaW5nIHdoaXRlc3BhY2UgZnJvbSBmaXJzdCBsaW5lXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJXaGVuIGNvcHlpbmcgYSBsaW5lIHdpdGhvdXQgaGF2aW5nIHNlbGVjdGVkIGEgc3BlY2lmaWMgcGFydCBvZiB0aGF0IGxpbmUsIHJlbW92ZSBhbnkgd2hpdGVzcGFjZSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb3B5LlwiXG4gICAgICApXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncztcbiAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHNldHRpbmdzLnJlbW92ZUxlYWRpbmdXaGl0ZXNwYWNlKS5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICBzZXR0aW5ncy5yZW1vdmVMZWFkaW5nV2hpdGVzcGFjZSA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTm90aWNlIiwiUGx1Z2luIiwiUGx1Z2luU2V0dGluZ1RhYiIsIlNldHRpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF1REE7QUFDTyxTQUFTLFNBQVMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUU7QUFDN0QsSUFBSSxTQUFTLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxPQUFPLEtBQUssWUFBWSxDQUFDLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLFVBQVUsT0FBTyxFQUFFLEVBQUUsT0FBTyxDQUFD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
